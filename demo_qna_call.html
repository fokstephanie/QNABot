<!- Final answer being displayed back to user is "answer" ->

<!DOCTYPE html>
<html>
	<head>
	    <title>JSSample</title>
	</head>
	<body>

	<textarea id="send_question" rows="5" cols="50">mhs tokens</textarea>
	<button id="send" onclick="send_message()">Send</button>
	<p id="demo"></p>

		<script type="text/javascript">
			function check_scores(response) {
				var num = 0;
				for(i = 0; i < Object.keys(response.answers).length; i++){
	        		var score = response.answers[i]['score'];
	        		if (score > 50){
	        			num = i + 1;
	        		}
	        	}
	        	return num;
			}

			function send_message() {
		        var request = document.getElementById("send_question").value;
		        var answer = "";
		        // Call QnaMaker API
		     	var xhttp = new XMLHttpRequest();
		        xhttp.open("POST", "https://westus.api.cognitive.microsoft.com/qnamaker/v2.0/knowledgebases/48b67d6b-b091-4680-a5ae-499887068a92/generateAnswer", true);
		        xhttp.setRequestHeader("Content-type", "application/json");
		        xhttp.setRequestHeader("Ocp-Apim-Subscription-Key", "71ca9ea946d2460d85df1b7243583747");
		        xhttp.send("{ \"question\": \"" + request + "\", \"top\": 3 }");

		      	xhttp.onreadystatechange = function() {
		        	if (this.readyState == 4 && this.status == 200) {
			        	var response = JSON.parse(xhttp.responseText);

			        	// Check confidence scores for top responses
			        	var num_of_responses = check_scores(response);

			        	if (num_of_responses == 0){
			        		answer = "Sorry, I'm having some trouble understanding what you mean. Your question may be too broad, or too specific. Please try rewording your question, or [contact us](https://www.mhs.com/About/Contact-Us).";
			        	}
			        	else if (num_of_responses == 1){
				        	answer = response.answers[0]['answer'];
			        	}
			        	// Display multiple possible questions if more than 1 answer is matched
			        	else {

			        	}
			          	// Find and replace hyperlinked text
			          	var pattern = /\[(.*?)\]\((.*?)\)/g;
    					var links = answer.match(pattern); // Array of links

    					// Display answer
			          	document.getElementById("demo").innerHTML = answer;
		        	}
		      	}; 
			}
		</script>
	</body>
</html>